{
  "name": "Restaurant Orders to Telegram",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// –†–∞–±–æ—á–∏–π –∫–æ–¥ –¥–ª—è n8n - –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ body\n// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ —É–∑–ª–µ Code\n\nconsole.log('=== –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò ===');\nconsole.log('$input:', JSON.stringify($input, null, 2));\n\n// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ body\nlet orderData = null;\n\n// –í n8n –¥–∞–Ω–Ω—ã–µ –∏–∑ Webhook –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ body\nif ($input.item && $input.item.json && $input.item.json.body) {\n  // –î–∞–Ω–Ω—ã–µ –≤ body (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –æ–±—ä–µ–∫—Ç)\n  const body = $input.item.json.body;\n  orderData = typeof body === 'string' ? JSON.parse(body) : body;\n  console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–∞–π–¥–µ–Ω—ã –≤: $input.item.json.body');\n} else if ($input.item && $input.item.json) {\n  // –î–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –≤ json\n  orderData = $input.item.json;\n  console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–∞–π–¥–µ–Ω—ã –≤: $input.item.json');\n} else if ($input.body) {\n  // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç\n  orderData = typeof $input.body === 'string' ? JSON.parse($input.body) : $input.body;\n  console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–∞–π–¥–µ–Ω—ã –≤: $input.body');\n} else {\n  console.error('‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!');\n  return {\n    json: {\n      message: '‚ùå –û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ body',\n      orderNumber: 'ERROR',\n      totalAmount: 0\n    }\n  };\n}\n\nconsole.log('orderData:', JSON.stringify(orderData, null, 2));\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö\nif (!orderData) {\n  return {\n    json: {\n      message: '‚ùå –û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞',\n      orderNumber: 'ERROR',\n      totalAmount: 0\n    }\n  };\n}\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ\nconst orderNumber = orderData.orderNumber || 'UNKNOWN';\nconst totalAmount = orderData.totalAmount || 0;\nconst time = orderData.time || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ';\nconst date = orderData.date || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ';\n\nconsole.log('orderNumber:', orderNumber);\nconsole.log('totalAmount:', totalAmount);\nconsole.log('has items:', !!orderData.items);\nconsole.log('items type:', typeof orderData.items);\nconsole.log('items is array:', Array.isArray(orderData.items));\n\n// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –±–ª—é–¥\nlet itemsText = '';\n\nif (orderData.items && Array.isArray(orderData.items) && orderData.items.length > 0) {\n  console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ items, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:', orderData.items.length);\n  \n  orderData.items.forEach((item, index) => {\n    try {\n      console.log(`–û–±—Ä–∞–±–æ—Ç–∫–∞ item ${index}:`, JSON.stringify(item, null, 2));\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —ç–ª–µ–º–µ–Ω—Ç–∞\n      if (!item || !item.item) {\n        console.warn(`Item ${index}: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –±–ª—é–¥–µ`);\n        itemsText += `${index + 1}. [–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –±–ª—é–¥–µ]\\n`;\n        return;\n      }\n      \n      const itemName = item.item.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –±–ª—é–¥–æ';\n      const quantity = item.quantity || 1;\n      const price = item.item.price || 0;\n      const itemTotal = price * quantity;\n      \n      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞—Ö\n      let removedInfo = '';\n      if (item.removedIngredients && Array.isArray(item.removedIngredients) && item.removedIngredients.length > 0) {\n        removedInfo = `\\n   –ë–µ–∑: ${item.removedIngredients.join(', ')}`;\n      }\n      \n      itemsText += `${index + 1}. ${itemName} x${quantity} - ${itemTotal} ‚ÇΩ${removedInfo}\\n`;\n      console.log(`Item ${index} –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ`);\n    } catch (itemError) {\n      console.error(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ item ${index}:`, itemError);\n      itemsText += `${index + 1}. [–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–ª—é–¥–∞]\\n`;\n    }\n  });\n} else {\n  console.warn('–ù–µ—Ç items –∏–ª–∏ items –Ω–µ –º–∞—Å—Å–∏–≤');\n  itemsText = '[–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –±–ª—é–¥–∞—Ö]';\n}\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\nconst message = `üçΩÔ∏è *–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ #${orderNumber}*\n\nüìÖ –î–∞—Ç–∞: ${date}\nüïê –í—Ä–µ–º—è: ${time}\n\nüìã *–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:*\n${itemsText}\n\nüí∞ *–ò—Ç–æ–≥–æ: ${totalAmount} ‚ÇΩ*\n\n${orderData.restaurantId ? `üè¢ ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞: ${orderData.restaurantId}` : ''}`;\n\nconsole.log('–ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:', message);\nconsole.log('=== –ö–û–ù–ï–¶ –û–ë–†–ê–ë–û–¢–ö–ò ===');\n\nreturn {\n  json: {\n    message: message,\n    orderNumber: orderNumber,\n    totalAmount: totalAmount\n  }\n};\n\n"
      },
      "id": "a84f2ddf-d030-47f8-912a-a0e3f8cd34d5",
      "name": "Format Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        144,
        5568
      ]
    },
    {
      "parameters": {
        "chatId": "1267841885",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "dba7b4f8-4ff3-4ebb-842c-e00eb396a0be",
      "name": "Send to Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        336,
        5568
      ],
      "webhookId": "1dcba989-963d-4d18-86bc-ab49e51fbd7e",
      "credentials": {
        "telegramApi": {
          "id": "4BBQ9WgVlYoftMZm",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"success\": true, \"orderNumber\": $json.orderNumber } }}",
        "options": {}
      },
      "id": "98ee37db-5f14-4438-a16a-4ec4f319a475",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        560,
        5680
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "order",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "bf79bd41-9c52-490c-8d32-f3c406fbe88f",
      "name": "Webhook1",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -48,
        5760
      ],
      "webhookId": "order"
    }
  ],
  "pinData": {},
  "connections": {
    "Format Message": {
      "main": [
        [
          {
            "node": "Send to Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to Telegram": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "Format Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2bb7c04f-8ea7-40f8-9f48-e5d98e53989e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "6039fc29fe4ac65ea1725fdf96ede33412c4e3d72ed06fe6c55a0d9d93ba077a"
  },
  "id": "HTIjVEkhOcHq2az5",
  "tags": []
}